---
title: "Report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction

TODO

### Problem Statement

TODO

### Research Questions

TODO

### Research Objectives

TODO

### Dataset

TODO

### Metadata

| Variable | Description |
| --- | --- |
| TODO | TODO |

### References

TODO


### Imports

```{r}
library(dplyr)
library(ggplot2)
library(caret)
```

```{r}
df <- read.csv("../data/student-por.csv", sep = ";", stringsAsFactors = TRUE)
head(df)
```

### Preprocessing

```{r}
str(df)
```

```{r}
summary(df)
```

Convert ordinal variables into ordered factors.

```{r}
df$famsize <- factor(df$famsize, ordered = TRUE, levels = c("LE3", "GT3"))
df$Medu <- factor(df$Medu, ordered = TRUE, levels = 0:4)
df$Fedu <- factor(df$Fedu, ordered = TRUE, levels = 0:4)
df$traveltime <- factor(df$traveltime, ordered = TRUE, levels = 1:4)
df$studytime <- factor(df$studytime, ordered = TRUE, levels = 1:4)
df$failures <- factor(df$failures, ordered = TRUE, levels = 0:4)
df$famrel <- factor(df$famrel, ordered = TRUE, levels = 1:5)
df$freetime <- factor(df$freetime, ordered = TRUE, levels = 1:5)
df$goout <- factor(df$goout, ordered = TRUE, levels = 1:5)
df$Dalc <- factor(df$Dalc, ordered = TRUE, levels = 1:5)
df$Walc <- factor(df$Walc, ordered = TRUE, levels = 1:5)
df$health <- factor(df$health, ordered = TRUE, levels = 1:5)
```

Create label from `G3`.

```{r}
df$result <- ifelse(df$G3 >= 10, "pass", "fail")
df$result <- as.factor(df$result)
```

### Descriptive Analysis

```{r}
str(df)
```

```{r}
summary(df)
```

### Exploratory Data Analysis

#### Univariate

```{r}
ggplot(df, aes(x = school)) + 
  geom_bar(fill='blue') +
  labs(x = "School",
       y = "No. of students",
       title = "1. Student's school")

ggplot(df, aes(x = sex)) + 
  geom_bar(fill='blue') +
  labs(x = "Sex",
       y = "No. of students",
       title = "2. Student's sex")

ggplot(df, aes(x = age)) + 
  geom_bar(fill='green', 
                 color = "black") +
  labs(x = "Age",
       y = "Frequency",
       title = "3. Student's age")

ggplot(df, aes(x = address)) + 
  geom_bar(fill='purple') +
  labs(x = "Address",
       y = "Frequency",
       title = "4. Student's home address type")

ggplot(df, aes(x = famsize)) + 
  geom_bar(fill='purple') +
  labs(x = "Family size",
       y = "Frequency",
       title = "5. Family size ")

ggplot(df, aes(x = Pstatus)) + 
  geom_bar(fill='purple') +
  labs(x = "Parent's Status",
       y = "Frequency",
       title = "6. Parent's cohabitation status ")

ggplot(df, aes(x = Medu)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Medu",
       y = "Frequency",
       title = "7. Mother's education level")

ggplot(df, aes(x = Fedu)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Fedu",
       y = "Frequency",
       title = "8. Father's education level")

ggplot(df, aes(x = Mjob)) + 
  geom_bar(fill='purple') +
  labs(x = "Mjob",
       y = "Frequency",
       title = "9. Mother's job")

ggplot(df, aes(x = Fjob)) + 
  geom_bar(fill='purple') +
  labs(x = "Fjob",
       y = "Frequency",
       title = "10. Father's job")

ggplot(df, aes(x = reason)) + 
  geom_bar(fill='purple') +
  labs(x = "Reason",
       y = "Frequency",
       title = "11. Reason for selecting school")

ggplot(df, aes(x = guardian)) + 
  geom_bar(fill='purple') +
  labs(x = "Guardian",
       y = "Frequency",
       title = "12. Student's guardian")

ggplot(df, aes(x = traveltime)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Traveltime",
       y = "Frequency",
       title = "13. Home to school travel time")

ggplot(df, aes(x = studytime)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Studytime",
       y = "Frequency",
       title = "14. Weekly study time")

ggplot(df, aes(x = failures)) +
  geom_bar(fill = "green", 
                 color = "black") + 
  labs(title="15. Number of past class failures")

ggplot(df, aes(x = schoolsup)) + 
  geom_bar(fill='blue') +
  labs(x = "Schoolsup",
       y = "Frequency",
       title = "16. Extra educational support")

ggplot(df, aes(x = famsup)) + 
  geom_bar(fill='blue') +
  labs(x = "Famsup",
       y = "Frequency",
       title = "17. Family educational support")

ggplot(df, aes(x = paid)) + 
  geom_bar(fill='blue') +
  labs(x = "Paid",
       y = "Frequency",
       title = "18. Extra paid Portuguese classes ")

ggplot(df, aes(x = activities)) + 
  geom_bar(fill='blue') +
  labs(x = "Activities",
       y = "Frequency",
       title = "19. Extra-curricular activities")

ggplot(df, aes(x = nursery)) + 
  geom_bar(fill='blue') +
  labs(x = "Nursery",
       y = "Frequency",
       title = "20. Attended nursery school")

ggplot(df, aes(x = higher)) + 
  geom_bar(fill='blue') +
  labs(x = "Higher",
       y = "Frequency",
       title = "21. Wants to take higher education")

ggplot(df, aes(x = internet)) + 
  geom_bar(fill='blue') +
  labs(x = "Internet",
       y = "Frequency",
       title = "22. Internet access at home")

ggplot(df, aes(x = romantic)) + 
  geom_bar(fill='blue') +
  labs(x = "Romantic",
       y = "Frequency",
       title = "23. In a romantic relationship")

ggplot(df, aes(x = famrel)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Famrel",
       y = "Frequency",
       title = "24. Quality of family relationship")

ggplot(df, aes(x = freetime)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Freetime",
       y = "Frequency",
       title = "25. Free time after school")

ggplot(df, aes(x = goout)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Goout",
       y = "Frequency",
       title = "26. Going out with friends")

ggplot(df, aes(x = Dalc)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Dalc",
       y = "Frequency",
       title = "27. Workday alcohol consumption")

ggplot(df, aes(x = Walc)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "Walc",
       y = "Frequency",
       title = "28. Weekend alcohol consumption")

ggplot(df, aes(x = health)) + 
  geom_bar(fill='white', 
                 color = "black") +
  labs(x = "health",
       y = "Frequency",
       title = "29. Current health status")

ggplot(df, aes(x = absences)) + 
  geom_bar(fill='green', 
                 color = "black")+
  labs(x = "Absences",
       y = "Frequency",
       title = "30. Number of school absences")

ggplot(df, aes(x = G1)) + 
  geom_bar(fill='pink', 
                 color = "black") +
  labs(x = "G1",
       y = "Frequency",
       title = "31. First period grade")

ggplot(df, aes(x = G2)) + 
  geom_bar(fill='pink', 
                 color = "black") +
  labs(x = "G2",
       y = "Frequency",
       title = "32. Second period grade")

ggplot(df, aes(x = G3)) + 
  geom_bar(fill='orange', 
                 color = "black") +
  labs(x = "G3",
       y = "Frequency",
       title = "33. Final grade-output target")

ggplot(df, aes(x = result)) + 
  geom_bar(fill='blue', 
                 color = "black") +
  labs(x = "Result",
       y = "Frequency",
       title = "34. Final grade-result")
```

#### Bivariate

```{r}
# TODO
```

### Correlation Analysis

```{r}
# TODO
```

### Train-Test Split

Create train set and test set for regression and classification respectively.

#### Regression

```{r}
df_reg <- df

df_reg$result <- NULL

set.seed(42)

train_index_reg <- createDataPartition(
  df_reg$G3,
  p = 0.8,
  list = FALSE,
  times = 1
)

train_set_reg <- df_reg[train_index_reg, ]
test_set_reg <- df_reg[-train_index_reg, ]
```

#### Classification

```{r}
df_clf <- df

df_clf$G3 <- NULL

set.seed(42)

train_index_clf <- createDataPartition(
  df_clf$result,
  p = 0.8,
  list = FALSE,
  times = 1
)

train_set_clf <- df_clf[train_index_clf, ]
test_set_clf <- df_clf[-train_index_clf, ]
```

### Subsampling

Since we are dealing with imbalanced classes, we explore subsampling techniques for classification.

#### Original Sample

```{r}
table(train_set_clf$result)
```

#### Down-Sampling

```{r}
set.seed(42)

train_set_clf_down <- downSample(
  x = train_set_clf[, -ncol(train_set_clf)],
  y = train_set_clf$result,
  yname = "result"
)

table(train_set_clf_down$result)
```

#### Up-Sampling

```{r}
set.seed(42)

train_set_clf_up <- upSample(
  x = train_set_clf[, -ncol(train_set_clf)],
  y = train_set_clf$result,
  yname = "result"
)

table(train_set_clf_up$result)
```

### Modeling

Define repeated 10-fold cross validation.

```{r}
fit_control <- trainControl(
  method = "repeatedcv",
  number = 10,
  repeats = 10
)
```

#### Regression

```{r}
# TODO
```

#### Classification

```{r}
# TODO
```

### Evaluation

#### Regression

```{r}
# TODO
```

#### Classification

```{r}
# TODO
```

### Conclusion

TODO
