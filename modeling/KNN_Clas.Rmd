---
title: "KNN Classification"
output: html_notebook
---

Load packages
```{r}
library(caret)
library(class)
library(dplyr)
library(e1071)
library(FNN) 
library(gmodels) 
library(psych)
```

Read file
```{r}
student_por<-read.csv('/Users/jamie/Documents/GitHub/programming-group-project/data/student-por_v3.csv', header = TRUE, sep = ",")
str(student_por)
```


Change all variable names to lowercase
```{r}
var.names.data <-tolower(colnames(student_por))
colnames(student_por) <- var.names.data
str(student_por)
```

# KNN Classification
## 1. Preparing the data
```{r}
# make copy of the dataset
data_class <- student_por
# put outcome in its own object
result_outcome <- data_class %>% select(result)
# remove original variable from the data set
data_class <- data_class %>% select(-result)
```

Scale integers in dataset
```{r}
data_class[, c("age", "medu", "fedu", "traveltime", "studytime", "failures", "famrel", "freetime", "goout", "Dalc", "alc", "health", "absences", "g1", "g2", "g3")] <- scale(data_class[, c("age", "medu", "fedu", "traveltime", "studytime", "failures", "famrel", "freetime", "goout", "dalc", "walc", "health", "absences", "g1", "g2", "g3")])

head(data_class)
```

Dummy code factors and categorical variables
Variables with two levels
```{r}
data_class$schoolsup <- ifelse(data_class$schoolsup == "yes", 1, 0)
data_class$famsup <- ifelse(data_class$famsup == "yes", 1, 0)
data_class$paid <- ifelse(data_class$paid == "yes", 1, 0)
data_class$activities <- ifelse(data_class$activities == "yes", 1, 0)
data_class$nursery <- ifelse(data_class$nursery == "yes", 1, 0)
data_class$higher <- ifelse(data_class$higher == "yes", 1, 0)
data_class$internet <- ifelse(data_class$internet == "yes", 1, 0)
data_class$romantic <- ifelse(data_class$romantic == "yes", 1, 0)
```

Variables that are two levels, but non-numeric
```{r}
data_class$school <- dummy.code(data_class$school)
data_class$sex <- dummy.code(data_class$sex)
data_class$address <- dummy.code(data_class$address)
data_class$famsize <- dummy.code(data_class$famsize)
data_class$pstatus <- dummy.code(data_class$pstatus)
```

Variables that are three or more levels
```{r}
mjob <- as.data.frame(dummy.code(data_class$mjob))
fjob <- as.data.frame(dummy.code(data_class$fjob))
reason <- as.data.frame(dummy.code(data_class$reason))
guardian <- as.data.frame(dummy.code(data_class$guardian))
str(mjob)
str(fjob)
str(reason)
str(guardian)
```

Rename columns to prevent duplication
```{r}
mjob <- rename(mjob, other_mjob = other)
mjob <- rename(mjob, services_mjob = services)
mjob <- rename(mjob, at_home_mjob = at_home)
mjob <- rename(mjob, teacher_mjob = teacher)
mjob <- rename(mjob, health_mjob = health)

fjob <- rename(fjob, other_fjob = other)
fjob <- rename(fjob, services_fjob = services)
fjob <- rename(fjob, at_home_fjob = at_home)
fjob <- rename(fjob, teacher_fjob = teacher)
fjob <- rename(fjob, health_fjob = health)

reason <- rename(reason, other_reason = other)

guardian <- rename(guardian, other_guardian = other)

str(mjob)
str(fjob)
str(reason)
str(guardian)
```

Combine new dummy variables with original data set
```{r}
data_class <- cbind(data_class, mjob, fjob, guardian, reason)
```

Remove original variables that had ot be dummy coded
```{r}
data_class <- data_class %>% select(-one_of(c("mjob", "fjob", "guardian", "reason")))
```

## 2. Split data into training and test set

```{r}
# set the seed to make the partition reproducible
set.seed(8) 

# 75% of the sample size
smp_size <- floor(0.75 * nrow(data_class))

train_ind <- sample(seq_len(nrow(data_class)), size = smp_size)

# creating test and training sets that contain all of the predictors
class_pred_train <- data_class[train_ind, ]
class_pred_test <- data_class[-train_ind, ]
```

Split outcome variable into training and test sets using the same partition as above.
```{r}
result_outcome_train <- result_outcome[train_ind, ]
result_outcome_test <- result_outcome[-train_ind, ]
```

## 3.KNN classification using caret package 
```{r}
result_pred_caret <- train(class_pred_train, result_outcome_train, method = "knn", preProcess = c("center","scale"))
```

```{r}
result_pred_caret
```

```{r}
plot(result_pred_caret)
```

Using results of KNN=9 to predict
```{r}
result_pred_knn <- knn(train = class_pred_train, test = class_pred_test, cl = result_outcome_train, k=9)
```

## 4.Model evaluation
```{r}
# put "result_outcome_test" in a data frame
result_outcome_test <- data.frame(result_outcome_test)

# merge "result_pred_knn" and "result_outcome_test" 
class_comparison <- data.frame(result_pred_knn, result_outcome_test)

# specify column names for "class_comparison"
names(class_comparison) <- c("PredictedResult", "ObservedResult")

# inspect "class_comparison" 
head(class_comparison)
```
```{r}
# create table examining model accuracy
CrossTable(x = class_comparison$ObservedResult, y = class_comparison$PredictedResult, prop.chisq=FALSE, prop.c = FALSE, prop.r = FALSE, prop.t = FALSE)
```

#### Comments
Model reveals passes easier to predict than fails.
